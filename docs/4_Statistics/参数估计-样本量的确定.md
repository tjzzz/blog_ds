抽样中样本量的确定是一个非常重要的问题，在不考虑抽样成本的前提下，样本量越多估计的越准，然而实际情况中我们需要平衡抽样成本与估计结果的置信度——以尽可能低的样本得到尽可能高的置信结果。

# 1.均值估计的样本量
先来说一个简单的例子
【例子】假设我们想估计一个学校中学生的平均身高。希望误差能控制在d=1cm范围内，那么至少要抽取多少学生数呢？

假设学生的身高是随机变量$x$, 我们知道均值是近似服从正态分布的。当样本量较大的时候可以直接用正态分布进行置信区间估计，当样本量较小的时候可以用t分布进行置信区间估计。
检验的置信区间是 $[ \bar x \pm t_{\alpha/2}\frac{s}{\sqrt n} ]$, 因此有
$$d=t\frac{s}{\sqrt n} 或者 d=z\frac{s}{\sqrt n}$$


从而可以推出来所需要的样本量
$$n=\frac{t^2s^2}{d^2}或者n=\frac{z^2s^2}{d^2}$$

说明：

* 这里$s^2$即为方差，可以通过样本进行估计
* $d$是实验的临界误差，在这个例子中是1cm，在不同的场合下没有一个固定的办法去确定一个合适的d，比如就是误差是在1cm可以接受，还是0.1cm可以接受，这个往往由具体的业务场景来人工决定。
* 对于大样本来说，z检验其临界的水平可以直接查表或者计算出，但是当小样本时候，t检验来说略微有些不同。因为t检验的t值还取决于本身的自由度df=n-1,其也是关于n的函数。

**小样本的t检验迭代法**

(1) 先用z分数替代t分数，计算所需的样本量n
(2) 根据计算出来的n，在df=n-1的条件下，用t分数替代上一步的z分数，重新计算所需样本量n
(3) 由于t分布比z分布扁平一些，相同置信度下，t分数>z分布。所以(2)新估计出来的n要比(1)的略大。
(4) 依次重复该步骤，当发现相邻两次迭代中n(取整之后)相同，则停止迭代流程即可。


**没有方差的预估**

前面说明中$s^2$为方差，可以通过样本进行预估，假设我们很不幸连方差的样本信息也没有该怎么办呢？


$$n=\frac{t^2}{e^2}或者n=\frac{z^2}{e^2}$$
其中$e=\frac{d}{s}$ 即我们不去关注方差的情况，而关于误差相比于标准差的比例，即标准化d。

**如何控制变异性**
在实验设计时候，我们可以控制实验的显著性水平$\alpha$，临界差值d的大小，以及最终的样本量。那边在实际做问卷调查的时候，如何去尽量减小数据的变异性呢。《用户体验度量》一书中给了一些可供参考的建议：

* 确保被测者了解他们应该做什么，或者在不透漏信息的条件下让他们提前熟悉测试华景。
* 如果合适使用专家测试而非新手用户。如果两个都需要，那么可以针对两组用户不同的样本量。
* 对可能和均值、方差相关的测量进行数据转换。比如一些有偏态分布的做对数转换。

# 2.比例估计的样本量

与均值的类似，
**(1)在大样本条件下**
$$n=\frac{z^2\hat p(1-\hat p)}{d^2}$$
在p未知的情况下，可以用其上限p=0.5进行估计。

**(2)小样本条件下**
根据wald矫正的p进行估计



如果是无放回的条件下，整体的方差
$$\frac{N-n}{N-1}\frac{p(1-p)}{n}$$
反解样本量：




# 3卡方检验的样本量


# 4.常见问题
## 比例类估计样本量如何确定-冷启动
根据前面的设计方式，反解出来的样本量与真实的p是有关系的，但是我们的目的就是要估计真实的p。
- 如果有一些业务先验信息，知道p的大致范围，可以带入估计
- 如果完全未知，是一个冷启动问题，可以类似推荐系统冷启动中估计p的方式


